# Function to check and start VSS service if not running
function Ensure-VSSService {
    $service = Get-Service -Name 'VSS'
    if ($service.Status -ne 'Running') {
        Start-Service -Name 'VSS'
        Write-Output "VSS service started."
    } else {
        Write-Output "VSS service is already running."
    }
}

# Prompt user for volume
$volume = Read-Host "Enter the volume (e.g., C:)"

# Prompt user for number of shadow copies and ensure it's an integer
$numCopies = $null
while (-not [int]::TryParse((Read-Host "Enter the number of shadow copies to create"), [ref]$numCopies)) {
    Write-Output "Please enter a valid integer for the number of shadow copies."
}

# Ensure VSS service is running
Ensure-VSSService

# Loop to create the specified number of shadow copies
for ($i = 1; $i -le $numCopies; $i++) {
    try {
        $result = wmic shadowcopy call create Volume="$volume"
        if ($result.ReturnValue -eq 0) {
            Write-Output "Shadow copy $i created successfully."
        } else {
            Write-Output "Failed to create shadow copy $i. Error code: $($result.ReturnValue)"
        }
    } catch {
        Write-Output "Error creating shadow copy $i: $_"
    }
}
