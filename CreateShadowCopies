# Function to check if VSS service is running
function Check-VSSService {
    try {
        $service = Get-Service -Name 'VSS' -ErrorAction Stop
        if ($service.Status -eq 'Running') {
            return $true
        } else {
            return $false
        }
    } catch {
        Write-Output "Error checking VSS service: $_"
        return $false
    }
}

# Prompt the user to enter the volume and the number of shadow copies
$volume = Read-Host "Enter the volume (e.g., C:\)"
$numCopies = int

# Check if VSS service is running
if (Check-VSSService) {
    # Loop to create the specified number of shadow copies
    for ($i = 1; $i -le $numCopies; $i++) {
        try {
            $shadowCopy = Invoke-CimMethod -Namespace "root\cimv2" -ClassName "Win32_ShadowCopy" -MethodName "Create" -Arguments @{Volume = $volume; Context = "ClientAccessible"}

            # Check if the shadow copy was created successfully
            if ($shadowCopy.ReturnValue -eq 0) {
                Write-Output "Shadow copy $i created successfully."
            } else {
                Write-Output "Failed to create shadow copy $i. Error code: $($shadowCopy.ReturnValue)"
            }
        } catch {
            Write-Output "Error creating shadow copy $i: $_"
        }
    }
} else {
    Write-Output "VSS service is not running. Please start the VSS service and try again."
}
